import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css                   *//* empty css               */import"./main-C5KVrVRe.js";document.addEventListener("DOMContentLoaded",function(){const y=document.getElementById("tablaVentas").getElementsByTagName("tbody")[0],_=document.getElementById("agregarVenta"),A=document.getElementById("devoluciones"),f=document.getElementById("modalDetalleVenta"),s=document.getElementById("modalAgregarVenta"),m=document.getElementById("modalDevolucion"),h=document.getElementsByClassName("close"),L=document.getElementById("searchInput"),H=document.getElementById("searchButton"),R=document.getElementById("formAgregarVenta"),w=document.getElementById("formDevolucion"),D=document.getElementById("modalTitle"),B=document.getElementById("productoDevolucion"),N=document.getElementById("cantidadDevolucion"),U=document.getElementById("motivoDevolucion"),z=document.getElementById("reciboInput"),F=document.getElementById("subirRecibo"),S=document.getElementById("reciboPreview"),C=document.getElementById("categoria"),g=document.getElementById("producto"),P=document.getElementById("cantidad"),O=document.getElementById("agregarProducto"),$=document.getElementById("tablaProductosVenta").getElementsByTagName("tbody")[0],q=document.getElementById("total"),T=document.getElementById("reciboDevolucion"),V=document.getElementById("reciboDevolucionPreview"),j=[{id:1,nombre:"Vestidos"},{id:2,nombre:"Blusas"},{id:3,nombre:"Pantalones"},{id:4,nombre:"Accesorios"}],b=[{id:1,nombre:"Vestido de Seda",precio:25e4,categoria:1},{id:2,nombre:"Blusa de Algodón",precio:45e3,categoria:2},{id:3,nombre:"Pantalón de Lino",precio:9e4,categoria:3},{id:4,nombre:"Chaqueta de Cuero",precio:32e4,categoria:3},{id:5,nombre:"Falda Plisada",precio:75e3,categoria:1},{id:6,nombre:"Collar de Perlas",precio:12e4,categoria:4},{id:7,nombre:"Bolso de Cuero",precio:18e4,categoria:4},{id:8,nombre:"Blusa de Seda",precio:65e3,categoria:2}];let l=[],a=[],M=1;j.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.nombre,C.appendChild(t)}),C.addEventListener("change",function(){const e=parseInt(this.value);g.innerHTML='<option value="">Seleccione un producto</option>',b.filter(t=>t.categoria===e).forEach(t=>{const n=document.createElement("option");n.value=t.id,n.textContent=t.nombre,g.appendChild(n)})});let c=[];O.addEventListener("click",function(){const e=parseInt(g.value),t=parseInt(P.value),n=b.find(o=>o.id===e);if(n&&t>0){const o=n.precio*t;c.push({id:n.id,nombre:n.nombre,cantidad:t,precioUnitario:n.precio,subtotal:o}),p(),E(),g.value="",P.value="1"}else Swal.fire("Error","Por favor, seleccione un producto y una cantidad válida","error")});function p(){$.innerHTML="",c.forEach((e,t)=>{const n=$.insertRow();n.innerHTML=`
                <td>${e.nombre}</td>
                <td>${e.cantidad}</td>
                <td>${u(e.precioUnitario)}</td>
                <td>${u(e.subtotal)}</td>
                <td><button class="btn-remove" data-index="${t}">Eliminar</button></td>
            `}),document.querySelectorAll(".btn-remove").forEach(e=>{e.addEventListener("click",function(){const t=parseInt(this.getAttribute("data-index"));c.splice(t,1),p(),E()})})}function E(){const e=c.reduce((t,n)=>t+n.subtotal,0);q.value=u(e)}function u(e){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(e)}function x(e){const t=y.insertRow();t.innerHTML=`
            <td>${e.idVenta}</td>
            <td>${e.cliente}</td>
            <td>${e.fecha_venta}</td>
            <td>${u(e.total)}</td>
            <td>
                <button class="btn-detail" data-id="${e.idVenta}">Detalle</button>
                <button class="btn-edit" data-id="${e.idVenta}">Editar</button>
                <button class="btn-delete" data-id="${e.idVenta}">Eliminar</button>
            </td>
        `,t.querySelector(".btn-detail").addEventListener("click",()=>G(e.idVenta)),t.querySelector(".btn-edit").addEventListener("click",()=>J(e.idVenta)),t.querySelector(".btn-delete").addEventListener("click",()=>K(e.idVenta))}function I(){y.innerHTML="",l.forEach(x)}function G(e){const t=a.filter(o=>o.idVenta==e),n=document.getElementById("tablaDetalleVenta").getElementsByTagName("tbody")[0];n.innerHTML="",t.forEach(o=>{const i=n.insertRow();i.innerHTML=`
                <td>${o.idProducto}</td>
                <td>${o.producto}</td>
                <td>${o.cantidad}</td>
                <td>${u(o.precio_unitario)}</td>
                <td>${u(o.subtotal)}</td>
            `}),f.style.display="block"}function J(e){const t=l.find(n=>n.idVenta==e);t&&(document.getElementById("idVenta").value=t.idVenta,document.getElementById("cliente").value=t.cliente,document.getElementById("fecha_venta").value=t.fecha_venta,c=a.filter(n=>n.idVenta==e).map(n=>({id:n.idProducto,nombre:n.producto,cantidad:n.cantidad,precioUnitario:n.precio_unitario,subtotal:n.subtotal})),p(),E(),D.textContent="Editar Venta",s.style.display="block")}function K(e){Swal.fire({title:"¿Está seguro?",text:"No podrá revertir esta acción",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&(l=l.filter(n=>n.idVenta!=e),a=a.filter(n=>n.idVenta!=e),I(),Swal.fire("Eliminado","La venta ha sido eliminada.","success"))})}function Q(){B.innerHTML="",a.forEach(e=>{const t=document.createElement("option");t.value=e.idProducto,t.textContent=`${e.producto} (Ref: ${e.idProducto})`,B.appendChild(t)}),m.style.display="block"}_.addEventListener("click",function(){D.textContent="Nueva Venta",document.getElementById("idVenta").value="",document.getElementById("cliente").value="",document.getElementById("fecha_venta").value="",c=[],p(),E(),s.style.display="block"}),A.addEventListener("click",Q),R.addEventListener("submit",function(e){e.preventDefault();const t=document.getElementById("idVenta").value,n=document.getElementById("cliente").value,o=document.getElementById("fecha_venta").value,i=c.reduce((d,r)=>d+r.subtotal,0);if(n.trim()===""){Swal.fire("Error","El nombre del cliente es obligatorio","error");return}if(o===""){Swal.fire("Error","La fecha de venta es obligatoria","error");return}if(c.length===0){Swal.fire("Error","Debe agregar al menos un producto a la venta","error");return}const v={idVenta:t?parseInt(t):M++,cliente:n,fecha_venta:o,total:i};if(t){const d=l.findIndex(r=>r.idVenta==t);d!==-1&&(l[d]=v,a=a.filter(r=>r.idVenta!=t),a=a.concat(c.map(r=>({idVenta:v.idVenta,idProducto:r.id,producto:r.nombre,cantidad:r.cantidad,precio_unitario:r.precioUnitario,subtotal:r.subtotal}))),Swal.fire("Éxito","Venta actualizada correctamente","success"))}else l.push(v),a=a.concat(c.map(d=>({idVenta:v.idVenta,idProducto:d.id,producto:d.nombre,cantidad:d.cantidad,precio_unitario:d.precioUnitario,subtotal:d.subtotal}))),Swal.fire("Éxito","Nueva venta agregada correctamente","success");I(),s.style.display="none"}),w.addEventListener("submit",function(e){e.preventDefault();const t=B.value,n=parseInt(N.value),o=U.value,i=T.files[0];if(!t){Swal.fire("Error","Debe seleccionar un producto","error");return}if(isNaN(n)||n<=0){Swal.fire("Error","La cantidad debe ser un número positivo","error");return}if(o.trim()===""){Swal.fire("Error","Debe proporcionar un motivo para la devolución","error");return}if(!i){Swal.fire("Error","Debe subir el recibo de pago","error");return}Swal.fire({title:"Devolución Procesada",text:`Se ha procesado la devolución de ${n} unidad(es) del producto con ID ${t}. Recibo de pago recibido.`,icon:"success"}),m.style.display="none",w.reset(),V.innerHTML=""});function W(e){return e=e.toLowerCase(),l.filter(t=>t.idVenta.toString().includes(e)||t.cliente.toLowerCase().includes(e)||t.fecha_venta.includes(e)||t.total.toString().includes(e))}H.addEventListener("click",k),L.addEventListener("input",k);function k(){const e=L.value.toLowerCase(),t=W(e);y.innerHTML="",t.forEach(x)}for(let e=0;e<h.length;e++)h[e].onclick=function(){f.style.display="none",s.style.display="none",m.style.display="none"};window.onclick=function(e){e.target==f&&(f.style.display="none"),e.target==s&&(s.style.display="none"),e.target==m&&(m.style.display="none")},F.addEventListener("click",function(){const e=z.files[0];if(e){const t=new FileReader;t.onload=function(n){const o=document.createElement("img");o.src=n.target.result,S.innerHTML="",S.appendChild(o),Swal.fire("Éxito","Recibo de pago subido correctamente","success")},t.readAsDataURL(e)}else Swal.fire("Error","Por favor, seleccione un archivo","error")}),T.addEventListener("change",function(e){const t=e.target.files[0];if(t){const n=new FileReader;n.onload=function(o){const i=document.createElement("img");i.src=o.target.result,V.innerHTML="",V.appendChild(i)},n.readAsDataURL(t)}});for(let e=1;e<=5;e++){const t={idVenta:M++,cliente:`Cliente ${e}`,fecha_venta:`2023-09-${e.toString().padStart(2,"0")}`,total:Math.floor(Math.random()*1e6)+1e5};l.push(t);for(let n=1;n<=2;n++){const o=b[Math.floor(Math.random()*b.length)],i=Math.floor(Math.random()*3)+1;a.push({idVenta:t.idVenta,idProducto:o.id,producto:o.nombre,cantidad:i,precio_unitario:o.precio,subtotal:o.precio*i})}}I()});
